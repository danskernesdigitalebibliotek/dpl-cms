# This workflow takes care of building and publishing the source code of the Danish Public Libraries CMS.
name: Publish source

on:
  create
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
      with:
        fetch-depth: 0
    - name: Get version
      id: get_version
      run: |
        echo ::set-output name=SOURCE_VERSION::$(echo ${GITHUB_REF#refs/tags/} | cut -d '_' -f 2)
    - name: Install go-task
      uses: arduino/setup-task@v1
    - name: Build and publish source
      run: task source:deploy
      env:
        CR_PAT: ${{ secrets.GITHUB_TOKEN }}
        SOURCE_VERSION: ${{ steps.get_version.outputs.SOURCE_VERSION }}